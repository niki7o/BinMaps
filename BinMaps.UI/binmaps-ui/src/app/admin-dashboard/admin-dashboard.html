<div class="admin-dashboard">
  <!-- –•–µ–¥—ä—Ä —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
  <div class="admin-stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.TotalReports || 0 }}</div>
        <div class="stat-label">–û–±—â–æ —Ä–µ–ø–æ—Ä—Ç–∏</div>
      </div>
    </div>
    
    <div class="stat-card warning">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.PendingReports || 0 }}</div>
        <div class="stat-label">–ß–∞–∫–∞—â–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üóëÔ∏è</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.TotalContainers || 0 }}</div>
        <div class="stat-label">–û–±—â–æ –∫–æ—Ñ–∏</div>
      </div>
    </div>
    
    <div class="stat-card danger">
      <div class="stat-icon">üî•</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.FireReports || 0 }}</div>
        <div class="stat-label">–ü–æ–∂–∞—Ä–Ω–∏ —Å–∏–≥–Ω–∞–ª–∏</div>
      </div>
    </div>
    
    <div class="stat-card success">
      <div class="stat-icon">üë•</div>
      <div class="stat-content">
        <div class="stat-value">{{ userCount || 0 }}</div>
        <div class="stat-label">–†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–∏</div>
      </div>
    </div>
  </div>

  <!-- –¢–∞–±–æ–≤–µ –∑–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="admin-tabs">
    <button class="tab-btn" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
      üìù –†–µ–ø–æ—Ä—Ç–∏
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'containers'" (click)="setActiveTab('containers')">
      üóëÔ∏è –ö–æ—Ñ–∏
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'trucks'" (click)="setActiveTab('trucks')">
      üöõ –ö–∞–º–∏–æ–Ω–∏
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'users'" (click)="setActiveTab('users')">
      üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
    </button>
  </div>

  <!-- –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –Ω–∞ —Ç–∞–±–æ–≤–µ—Ç–µ -->
  <div class="tab-content">
    <!-- –¢–∞–± –∑–∞ —Ä–µ–ø–æ—Ä—Ç–∏ -->
    <div *ngIf="activeTab === 'reports'" class="tab-panel">
      <div class="filters">
        <select [(ngModel)]="reportFilter.status" (change)="filterReports()">
          <option value="">–í—Å–∏—á–∫–∏ —Å—Ç–∞—Ç—É—Å–∏</option>
          <option value="pending">–ß–∞–∫–∞—â–∏</option>
          <option value="approved">–û–¥–æ–±—Ä–µ–Ω–∏</option>
        </select>
        
        <select [(ngModel)]="reportFilter.reportType" (change)="filterReports()">
          <option value="">–í—Å–∏—á–∫–∏ —Ç–∏–ø–æ–≤–µ</option>
          <option value="Full">–ü—Ä–µ–ø—ä–ª–Ω–µ–Ω–∞</option>
          <option value="Fire">–ü–æ–∂–∞—Ä</option>
          <option value="SensorBroken">–°–µ–Ω–∑–æ—Ä</option>
        </select>
        
        <input type="date" [(ngModel)]="reportFilter.fromDate" (change)="filterReports()" placeholder="–û—Ç –¥–∞—Ç–∞">
        <input type="date" [(ngModel)]="reportFilter.toDate" (change)="filterReports()" placeholder="–î–æ –¥–∞—Ç–∞">
      </div>

      <div class="table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ö–æ—Ñ–∞</th>
              <th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</th>
              <th>–¢–∏–ø</th>
              <th>–î–∞—Ç–∞</th>
              <th>AI Score</th>
              <th>–†–µ–ø—É—Ç–∞—Ü–∏—è</th>
              <th>–§–∏–Ω–∞–ª–Ω–∞ —É–≤–µ—Ä–µ–Ω–æ—Å—Ç</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let report of filteredReports">
              <td>{{ report.id }}</td>
              <td>
                <span *ngIf="report.trashContainerId">#{{ report.trashContainerId }}</span>
                <span *ngIf="!report.trashContainerId">-</span>
              </td>
              <td>{{ report.userName }}</td>
              <td>
                <span class="report-type" [class]="getReportTypeClass(report.reportType)">
                  {{ getReportTypeText(report.reportType) }}
                </span>
              </td>
              <td>{{ formatDate(report.createdAt) }}</td>
              <td>
                <div class="score-bar">
                  <div class="score-fill" [style.width.%]="report.ai_Score"></div>
                  <span>{{ report.ai_Score }}%</span>
                </div>
              </td>
              <td>{{ report.userReputationOnSubmit }}</td>
              <td>
                <div class="confidence-badge" [class.high]="report.finalConfidence >= 80"
                     [class.medium]="report.finalConfidence >= 50 && report.finalConfidence < 80"
                     [class.low]="report.finalConfidence < 50">
                  {{ report.finalConfidence.toFixed(1) }}%
                </div>
              </td>
              <td>
                <span class="status-badge" [class.approved]="report.isApproved"
                      [class.pending]="!report.isApproved">
                  {{ report.isApproved ? '‚úì –û–¥–æ–±—Ä–µ–Ω' : '‚è≥ –ß–∞–∫–∞' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button *ngIf="!report.isApproved" class="btn-approve" 
                          (click)="approveReport(report.id)" title="–û–¥–æ–±—Ä–∏">
                    ‚úì
                  </button>
                  <button *ngIf="!report.isApproved" class="btn-reject" 
                          (click)="rejectReport(report.id)" title="–û—Ç—Ö–≤—ä—Ä–ª–∏">
                    ‚úó
                  </button>
                  <button class="btn-view" (click)="viewReportDetails(report)" title="–î–µ—Ç–∞–π–ª–∏">
                    üëÅÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- –¢–∞–± –∑–∞ –∫–æ—Ñ–∏ -->
    <div *ngIf="activeTab === 'containers'" class="tab-panel">
      <div class="table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ó–æ–Ω–∞</th>
              <th>–¢–∏–ø</th>
              <th>–ó–∞–ø—ä–ª–≤–∞–Ω–µ</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–°–µ–Ω–∑–æ—Ä</th>
              <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
              <th>–ë–∞—Ç–µ—Ä–∏—è</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let container of containers">
              <td>{{ container.id }}</td>
              <td>{{ container.areaId }}</td>
              <td>
                <span class="trash-type" [class]="getTrashTypeClass(container.trashType)">
                  {{ getTrashTypeText(container.trashType) }}
                </span>
              </td>
              <td>
                <div class="fill-bar">
                  <div class="fill-fill" [style.width.%]="container.fillPercentage"></div>
                  <span>{{ container.fillPercentage }}%</span>
                </div>
              </td>
              <td>
                <span class="status-badge" [class]="getStatusClass(container.status)">
                  {{ getStatusText(container.status) }}
                </span>
              </td>
              <td>
                <span class="sensor-badge" [class.has-sensor]="container.hasSensor">
                  {{ container.hasSensor ? '‚úì' : '‚úó' }}
                </span>
              </td>
              <td>
                <span [class.hot]="(container.temperature || 0) > 50">
                  {{ container.temperature || '-' }}¬∞C
                </span>
              </td>
              <td>
                <span *ngIf="container.batteryPercentage" 
                      [class.low-battery]="container.batteryPercentage < 20">
                  {{ container.batteryPercentage }}%
                </span>
                <span *ngIf="!container.batteryPercentage">-</span>
              </td>
              <td>
                <button class="btn-edit" (click)="editContainer(container)">‚úèÔ∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- –¢–∞–± –∑–∞ –∫–∞–º–∏–æ–Ω–∏ -->
    <div *ngIf="activeTab === 'trucks'" class="tab-panel">
      <div class="table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ó–æ–Ω–∞</th>
              <th>–¢–∏–ø</th>
              <th>–ö–∞–ø–∞—Ü–∏—Ç–µ—Ç</th>
              <th>–õ–æ–∫–∞—Ü–∏—è</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let truck of trucks">
              <td>{{ truck.id }}</td>
              <td>{{ truck.areaId }}</td>
              <td>
                <span class="trash-type" [class]="getTrashTypeClass(truck.trashType)">
                  {{ getTrashTypeText(truck.trashType) }}
                </span>
              </td>
              <td>{{ truck.capacity }}–ª</td>
              <td>
                <span *ngIf="truck.locationX && truck.locationY">
                  {{ truck.locationX.toFixed(4) }}, {{ truck.locationY.toFixed(4) }}
                </span>
                <span *ngIf="!truck.locationX || !truck.locationY">-</span>
              </td>
              <td>
                <button class="btn-view" (click)="viewTruckRoute(truck.id)">üó∫Ô∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- –¢–∞–± –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ -->
    <div *ngIf="activeTab === 'users'" class="tab-panel">
      <div class="table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ</th>
              <th>–ò–º–µ–π–ª</th>
              <th>–†–æ–ª—è</th>
              <th>–†–µ–ø—É—Ç–∞—Ü–∏—è</th>
              <th>–†–µ–ø–æ—Ä—Ç–∏</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.id }}</td>
              <td>{{ user.userName }}</td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [class]="user.roles[0]">
                  {{ user.roles[0] === 'Driver' ? '–®–æ—Ñ—å–æ—Ä' : '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª' }}
                </span>
              </td>
              <td>
                <div class="reputation-bar">
                  <div class="reputation-fill" [style.width.%]="user.reputation"></div>
                  <span>{{ user.reputation }}</span>
                </div>
              </td>
              <td>
                <span *ngIf="userReportCounts[user.id]">
                  {{ userReportCounts[user.id] }}
                </span>
                <span *ngIf="!userReportCounts[user.id]">0</span>
              </td>
              <td>
                <button class="btn-view" (click)="viewUserReports(user.id)">üìã</button>
                <button class="btn-edit" (click)="adjustUserReputation(user)">‚öñÔ∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª –∑–∞ –¥–µ—Ç–∞–π–ª–∏ –Ω–∞ —Ä–µ–ø–æ—Ä—Ç -->
  <div *ngIf="selectedReport" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>–î–µ—Ç–∞–π–ª–∏ –∑–∞ —Ä–µ–ø–æ—Ä—Ç #{{ selectedReport.id }}</h3>
        <button class="modal-close" (click)="closeModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="report-details">
          <div class="detail-row">
            <span class="detail-label">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª:</span>
            <span class="detail-value">{{ selectedReport.userName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">–ö–æ—Ñ–∞:</span>
            <span class="detail-value">#{{ selectedReport.trashContainerId || '–ù—è–º–∞' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">–¢–∏–ø:</span>
            <span class="detail-value">{{ getReportTypeText(selectedReport.reportType) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">–î–∞—Ç–∞:</span>
            <span class="detail-value">{{ formatDate(selectedReport.createdAt) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">AI Score:</span>
            <span class="detail-value">{{ selectedReport.ai_Score }}%</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">–†–µ–ø—É—Ç–∞—Ü–∏—è –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è:</span>
            <span class="detail-value">{{ selectedReport.userReputationOnSubmit }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">–§–∏–Ω–∞–ª–Ω–∞ —É–≤–µ—Ä–µ–Ω–æ—Å—Ç:</span>
            <span class="detail-value">{{ selectedReport.finalConfidence.toFixed(1) }}%</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">–°—Ç–∞—Ç—É—Å:</span>
            <span class="detail-value">
              {{ selectedReport.isApproved ? '–û–¥–æ–±—Ä–µ–Ω' : '–ß–∞–∫–∞—â –æ–¥–æ–±—Ä–µ–Ω–∏–µ' }}
            </span>
          </div>
        </div>
        
        <div *ngIf="selectedReportPhoto" class="report-photo">
          <h4>–°–Ω–∏–º–∫–∞</h4>
          <img [src]="selectedReportPhoto" alt="Report Photo" class="photo-preview">
        </div>
      </div>
      <div class="modal-footer">
        <button *ngIf="!selectedReport.isApproved" class="btn-approve" 
                (click)="approveReport(selectedReport.id)">
          ‚úì –û–¥–æ–±—Ä–∏ —Ä–µ–ø–æ—Ä—Ç
        </button>
        <button *ngIf="!selectedReport.isApproved" class="btn-reject" 
                (click)="rejectReport(selectedReport.id)">
          ‚úó –û—Ç—Ö–≤—ä—Ä–ª–∏ —Ä–µ–ø–æ—Ä—Ç
        </button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª –∑–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ—Ñ–∞ -->
  <div *ngIf="editingContainer" class="modal-overlay" (click)="closeContainerModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ—Ñ–∞ #{{ editingContainer.id }}</h3>
        <button class="modal-close" (click)="closeContainerModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>–ó–∞–ø—ä–ª–≤–∞–Ω–µ (%)</label>
          <input type="range" min="0" max="100" [(ngModel)]="editingContainer.fillPercentage">
          <span>{{ editingContainer.fillPercentage }}%</span>
        </div>
        
        <div class="form-group">
          <label>–°—Ç–∞—Ç—É—Å</label>
          <select [(ngModel)]="editingContainer.status">
            <option [value]="undefined">–ù–æ—Ä–º–∞–ª–µ–Ω</option>
            <option value="0">–ê–∫—Ç–∏–≤–µ–Ω</option>
            <option value="1">–ü–æ–∂–∞—Ä</option>
            <option value="2">–ü–æ–≤—Ä–µ–¥–µ–Ω</option>
            <option value="3">–ò–∑–≤—ä–Ω –ª–∏–Ω–∏—è</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" [(ngModel)]="editingContainer.hasSensor">
            –ò–º–∞ —Å–µ–Ω–∑–æ—Ä
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-save" (click)="saveContainer()">üíæ –ó–∞–ø–∞–∑–∏</button>
        <button class="btn-cancel" (click)="closeContainerModal()">–û—Ç–∫–∞–∑</button>
      </div>
    </div>
  </div>
</div>